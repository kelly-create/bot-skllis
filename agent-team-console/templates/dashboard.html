<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agent Team æ§åˆ¶å°</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --card-radius: 16px;
      --soft-border: #e9ecf3;
      --bg-page: #f4f6fb;
      --text-main: #1f2a44;
    }
    body { background: var(--bg-page); color: var(--text-main); }
    .navbar-brand { font-weight: 700; letter-spacing: .2px; }
    .top-pill { border: 1px solid rgba(255,255,255,.28); padding: .2rem .6rem; border-radius: 999px; }
    .soft-card { border: 1px solid var(--soft-border); border-radius: var(--card-radius); box-shadow: 0 6px 22px rgba(16,24,40,.04); }
    .soft-card .card-header { background: #fff; border-bottom: 1px solid var(--soft-border); font-weight: 600; }
    .metric-value { font-size: 1.7rem; font-weight: 700; line-height: 1.1; }
    .metric-label { color: #667085; font-size: .86rem; }
    .metric-icon { font-size: 1.15rem; }
    .phase-col { min-height: 420px; background: #fff; border-radius: 14px; border: 1px solid var(--soft-border); }
    .phase-head { border-bottom: 1px solid var(--soft-border); padding: .65rem .75rem; font-weight: 600; }
    .phase-body { padding: .65rem; max-height: 460px; overflow: auto; }
    .task-mini { border: 1px solid #e7eaf3; border-radius: 12px; background: #fbfcff; padding: .6rem; margin-bottom: .55rem; }
    .task-mini .title { font-size: .93rem; font-weight: 600; line-height: 1.3; }
    .muted-mini { color: #667085; font-size: .77rem; }
    .summary-chip { background: #eef2ff; color: #3730a3; border-radius: 999px; padding: .2rem .55rem; font-size: .75rem; }
    .sticky-block { position: sticky; top: 1rem; }
    .table thead th { background: #fafbff; }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid px-3">
    <span class="navbar-brand">Agent Team æ§åˆ¶å°</span>
    <div class="d-flex align-items-center gap-2 text-white small flex-wrap">
      <span class="top-pill">å¹¶å‘ä¸Šé™ {{ g.max_concurrent }}</span>
      <span class="top-pill">æ´»è·ƒ {{ g.active_workers }}</span>
      <span class="top-pill">æ’é˜Ÿ {{ queue_count }}</span>
      <button type="button" id="toggleRefreshBtn" class="btn btn-sm btn-outline-light py-0 px-2" onclick="toggleAutoRefresh()">è‡ªåŠ¨åˆ·æ–°ï¼šå¼€</button>
      <a class="btn btn-sm btn-outline-light" href="{{ url_for('artifacts_page') }}">å…¨å±€äº§ç‰©</a>
      <a class="btn btn-sm btn-light" href="{{ url_for('logout') }}">é€€å‡º</a>
    </div>
  </div>
</nav>

<div class="container-fluid px-3 px-lg-4 py-3 py-lg-4">
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="alert alert-info soft-card py-2">{{ messages[0] }}</div>
    {% endif %}
  {% endwith %}

  <div class="row g-3 mb-3">
    <div class="col-6 col-xl-3">
      <div class="card soft-card h-100"><div class="card-body d-flex justify-content-between align-items-center">
        <div><div class="metric-label">å¾…åŠ</div><div class="metric-value">{{ stats.pending }}</div></div><div class="metric-icon">ğŸ“</div>
      </div></div>
    </div>
    <div class="col-6 col-xl-3">
      <div class="card soft-card h-100"><div class="card-body d-flex justify-content-between align-items-center">
        <div><div class="metric-label">æ‰§è¡Œä¸­</div><div class="metric-value">{{ stats.running }}</div></div><div class="metric-icon">âš™ï¸</div>
      </div></div>
    </div>
    <div class="col-6 col-xl-3">
      <div class="card soft-card h-100"><div class="card-body d-flex justify-content-between align-items-center">
        <div><div class="metric-label">å·²å®Œæˆ</div><div class="metric-value">{{ stats.done }}</div></div><div class="metric-icon">âœ…</div>
      </div></div>
    </div>
    <div class="col-6 col-xl-3">
      <div class="card soft-card h-100"><div class="card-body d-flex justify-content-between align-items-center">
        <div><div class="metric-label">éœ€è¿”å·¥</div><div class="metric-value">{{ stats.failed }}</div></div><div class="metric-icon">ğŸš§</div>
      </div></div>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-12 col-xxl-8">
      <div class="card soft-card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span>æ–°å»ºä»»åŠ¡ï¼ˆå£è¯­åŒ–ï¼‰</span>
          <span class="summary-chip">æ”¯æŒå¤§æ®µæè¿° + é™„ä»¶</span>
        </div>
        <div class="card-body">
          <form method="post" action="{{ url_for('create_task') }}" enctype="multipart/form-data">
            <div class="row g-2">
              <div class="col-md-4">
                <label class="form-label">ä»»åŠ¡æ¨¡æ¿</label>
                <select class="form-select" name="workflow_template" id="workflow_template" onchange="onWorkflowChange()">
                  {% for wf in workflows %}
                    {% if wf.enabled == 1 %}
                    <option value="{{ wf.code }}" data-default-assignee="{{ wf.default_assignee or '' }}" data-default-task-type="{{ wf.default_task_type or '' }}" {% if wf.code == 'custom_brief' %}selected{% endif %}>
                      {{ wf.name }}ï¼ˆ{{ wf.code }}ï¼‰
                    </option>
                    {% endif %}
                  {% endfor %}
                </select>
              </div>
              <div class="col-md-8">
                <label class="form-label">ä»»åŠ¡æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰</label>
                <input class="form-control" name="title" placeholder="å¯ä¸å¡«ï¼Œç³»ç»Ÿä¼šä»ä»»åŠ¡æè¿°è‡ªåŠ¨æå–" />
              </div>
            </div>

            <div class="mt-2">
              <label class="form-label">ä»»åŠ¡æè¿°ï¼ˆå¿…å¡«ï¼‰</label>
              <textarea class="form-control" name="task_brief" rows="5" placeholder="ç›´æ¥ç”¨å£è¯­å†™ä½ çš„ç›®æ ‡ã€èƒŒæ™¯ã€çº¦æŸã€è¦æ±‚ã€‚" required></textarea>
            </div>

            <div class="row g-2 mt-1">
              <div class="col-md-8">
                <label class="form-label">æœŸæœ›äº¤ä»˜ï¼ˆå¯é€‰ï¼‰</label>
                <input class="form-control" name="delivery_expectation" placeholder="ä¾‹å¦‚ï¼šä¸€ä»½ç»“è®ºæ‘˜è¦ + å¯ä¸‹è½½zipåŒ… + å®¡è®¡è¯´æ˜" />
              </div>
              <div class="col-md-4">
                <label class="form-label">é™„ä»¶ä¸Šä¼ ï¼ˆå¯é€‰ï¼‰</label>
                <input type="file" class="form-control" name="attachments" multiple>
              </div>
            </div>

            <details class="mt-3 border rounded p-2 bg-light-subtle">
              <summary><b>é«˜çº§è®¾ç½®ï¼ˆå¯é€‰ï¼‰</b></summary>
              <div class="row g-2 mt-2">
                <div class="col-md-3">
                  <label class="form-label">ä»»åŠ¡ç±»å‹</label>
                  <select class="form-select" name="task_type" title="ä»»åŠ¡ç±»å‹">
                    <option value="general" selected>generalï¼ˆé€šç”¨ï¼‰</option>
                    <option value="backend">backendï¼ˆç ”å‘ï¼‰</option>
                    <option value="research">researchï¼ˆè°ƒç ”ï¼‰</option>
                    <option value="ops">opsï¼ˆè¿ç»´ï¼‰</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label class="form-label">æ‰§è¡Œè§’è‰²</label>
                  <select class="form-select" name="assignee" title="æ‰§è¡Œè§’è‰²">
                    {% for r in roles %}
                      {% if r.enabled == 1 %}
                      <option value="{{ r.code }}" {% if r.code == 'Lead Agent' %}selected{% endif %}>{{ r.name }}ï¼ˆ{{ r.code }}ï¼‰</option>
                      {% endif %}
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-2">
                  <label class="form-label">ä¼˜å…ˆçº§</label>
                  <select class="form-select" name="priority"><option>P0</option><option>P1</option><option selected>P2</option><option>P3</option></select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">é¡¹ç›®è·¯å¾„</label>
                  <input id="project_dir" class="form-control" name="project_dir" value="{{ g.workdir }}" placeholder="ä¾‹å¦‚ /opt/agent-team-console" />
                </div>
              </div>

              <div class="mt-2">
                <label class="form-label">è¡¥å……è¯´æ˜</label>
                <input class="form-control" name="description" placeholder="è¡¥å……éªŒæ”¶æ ‡å‡†ã€ç¦ç”¨é¡¹ã€é£é™©ç‚¹ç­‰" />
              </div>

              <div class="mt-2">
                <label class="form-label">è‡ªå®šä¹‰å‘½ä»¤ï¼ˆå¯é€‰ï¼‰</label>
                <input id="command_input" class="form-control" name="command" placeholder="ç•™ç©º=è‡ªåŠ¨ç”¨æ¨¡æ¿å‘½ä»¤ï¼›å¦‚æ¨¡æ¿æ— å‘½ä»¤åˆ™æ¼”ç¤ºæµç¨‹" />
              </div>
            </details>

            <div class="form-text mt-2">å¦‚æ¨¡æ¿éœ€è¦ç™»å½•æ€ï¼ˆä¾‹å¦‚å°çº¢ä¹¦ï¼‰ï¼Œè¯·ä¸Šä¼  <code>xhs_cookies.json</code> åˆ°å½“å‰ä»»åŠ¡é™„ä»¶ã€‚</div>
            <button class="btn btn-primary mt-3">åˆ›å»ºä»»åŠ¡</button>
          </form>
        </div>
      </div>

      <div class="card soft-card mb-3">
        <div class="card-header">ä¸šåŠ¡é˜¶æ®µçœ‹æ¿</div>
        <div class="card-body">
          <div class="row g-2">
            {% for phase in phase_order %}
            <div class="col-md-6 col-xl-3">
              <div class="phase-col">
                <div class="phase-head d-flex justify-content-between align-items-center">
                  <span>{{ phase }}</span>
                  <span class="badge text-bg-secondary">{{ tasks_by_phase.get(phase, [])|length }}</span>
                </div>
                <div class="phase-body">
                  {% if tasks_by_phase.get(phase, [])|length == 0 %}
                    <div class="text-muted small">æš‚æ— ä»»åŠ¡</div>
                  {% else %}
                    {% for t in tasks_by_phase.get(phase, []) %}
                    <div class="task-mini">
                      <div class="title">#{{ t.id }} <a href="{{ url_for('task_detail', task_id=t.id) }}">{{ t.title }}</a></div>
                      <div class="muted-mini mt-1">{{ t.assignee }} ï½œ {{ t.priority }} ï½œ {{ t.updated_at }}</div>
                      <div class="d-flex gap-1 flex-wrap mt-2">
                        <form method="post" action="{{ url_for('start_task_route', task_id=t.id) }}"><button class="btn btn-sm btn-outline-primary">å¯åŠ¨</button></form>
                        <form method="post" action="{{ url_for('stop_task', task_id=t.id) }}"><button class="btn btn-sm btn-outline-danger">åœæ­¢</button></form>
                        <form method="post" action="{{ url_for('retry_task', task_id=t.id) }}"><button class="btn btn-sm btn-outline-secondary">é‡ç½®</button></form>
                        <form method="post" action="{{ url_for('delete_task', task_id=t.id) }}" onsubmit="return confirm('ç¡®è®¤åˆ é™¤ä»»åŠ¡ #{{ t.id }} å—ï¼Ÿå°†åŒæ—¶åˆ é™¤æ—¥å¿—å’Œè¯¥ä»»åŠ¡é™„ä»¶/äº§ç‰©ã€‚');"><button class="btn btn-sm btn-danger">åˆ é™¤</button></form>
                      </div>
                    </div>
                    {% endfor %}
                  {% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <details class="card soft-card mb-3">
        <summary class="card-header" style="cursor:pointer;">æŠ€æœ¯æ˜ç»†è¡¨ï¼ˆé«˜çº§ï¼‰</summary>
        <div class="card-body py-2 small text-muted">æŒ‰æŠ€æœ¯å­—æ®µæŸ¥çœ‹å…¨éƒ¨ä»»åŠ¡ï¼ˆé€‚åˆæ’éšœï¼‰ã€‚</div>
        <div class="table-responsive">
          <table class="table table-sm table-hover mb-0 align-middle">
            <thead><tr><th>ID</th><th>æ ‡é¢˜</th><th>ç±»å‹</th><th>æ‰§è¡Œè€…</th><th>ä¼˜å…ˆçº§</th><th>çŠ¶æ€</th><th>è¿”å›ç </th><th>æ›´æ–°æ—¶é—´</th><th>æ“ä½œ</th></tr></thead>
            <tbody>
            {% for t in tasks %}
              <tr>
                <td>#{{ t.id }}</td>
                <td><a href="{{ url_for('task_detail', task_id=t.id) }}">{{ t.title }}</a></td>
                <td>{{ t.task_type }}</td>
                <td>{{ t.assignee }}</td>
                <td>{{ t.priority }}</td>
                <td>
                  {% if t.status == 'running' %}<span class="badge bg-warning text-dark">è¿è¡Œä¸­</span>
                  {% elif t.status == 'done' %}<span class="badge bg-success">å®Œæˆ</span>
                  {% elif t.status == 'failed' %}<span class="badge bg-danger">å¤±è´¥</span>
                  {% else %}<span class="badge bg-secondary">å¾…åŠ</span>{% endif %}
                </td>
                <td>{{ t.return_code if t.return_code is not none else '-' }}</td>
                <td>{{ t.updated_at }}</td>
                <td class="d-flex gap-1 flex-wrap">
                  <form method="post" action="{{ url_for('start_task_route', task_id=t.id) }}"><button class="btn btn-sm btn-outline-primary">å¯åŠ¨</button></form>
                  <form method="post" action="{{ url_for('stop_task', task_id=t.id) }}"><button class="btn btn-sm btn-outline-danger">åœæ­¢</button></form>
                  <form method="post" action="{{ url_for('retry_task', task_id=t.id) }}"><button class="btn btn-sm btn-outline-secondary">é‡ç½®</button></form>
                  <form method="post" action="{{ url_for('delete_task', task_id=t.id) }}" onsubmit="return confirm('ç¡®è®¤åˆ é™¤ä»»åŠ¡ #{{ t.id }} å—ï¼Ÿå°†åŒæ—¶åˆ é™¤æ—¥å¿—å’Œè¯¥ä»»åŠ¡é™„ä»¶/äº§ç‰©ã€‚');"><button class="btn btn-sm btn-danger">åˆ é™¤</button></form>
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </details>
    </div>

    <div class="col-12 col-xxl-4">
      <div class="sticky-block">
        <div class="card soft-card mb-3">
          <div class="card-header">ç³»ç»Ÿè®¾ç½®</div>
          <div class="card-body">
            <form class="row g-2 align-items-end" method="post" action="{{ url_for('set_concurrency') }}">
              <div class="col-5">
                <label class="form-label">å¹¶å‘ä¸Šé™</label>
                <input type="number" class="form-control" min="1" max="16" name="max_concurrent" value="{{ g.max_concurrent }}" required>
              </div>
              <div class="col-7 d-grid">
                <button class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
              </div>
            </form>
            <div class="small text-muted mt-2">å»ºè®® 2-6ï¼›å½“å‰æœºå™¨å…ˆç”¨ 4 æ›´ç¨³ã€‚</div>
          </div>
        </div>

        <div class="card soft-card mb-3">
          <div class="card-header">å…¨å±€è§’è‰²ä¸­å¿ƒ</div>
          <div class="card-body small">
            <div class="table-responsive mb-2">
              <table class="table table-sm align-middle">
                <thead><tr><th>è§’è‰²</th><th>æ¨¡å‹</th><th>çŠ¶æ€</th><th></th></tr></thead>
                <tbody>
                  {% for r in roles %}
                  <tr>
                    <td>
                      <div class="fw-semibold">{{ r.name }}</div>
                      <div class="text-muted">{{ r.code }}</div>
                    </td>
                    <td><code>{{ r.default_model or '-' }}</code></td>
                    <td>{% if r.enabled == 1 %}<span class="badge bg-success">å¯ç”¨</span>{% else %}<span class="badge bg-secondary">åœç”¨</span>{% endif %}</td>
                    <td>
                      <form method="post" action="{{ url_for('toggle_role', role_id=r.id) }}">
                        <button class="btn btn-sm btn-outline-secondary">{% if r.enabled == 1 %}åœç”¨{% else %}å¯ç”¨{% endif %}</button>
                      </form>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>

            <details>
              <summary>æ–°å¢è§’è‰²</summary>
              <form class="row g-2 mt-1" method="post" action="{{ url_for('create_role') }}">
                <div class="col-12"><input class="form-control form-control-sm" name="code" placeholder="codeï¼Œä¾‹å¦‚ @developer" required></div>
                <div class="col-12"><input class="form-control form-control-sm" name="name" placeholder="åç§°ï¼Œä¾‹å¦‚ å¼€å‘ Agent" required></div>
                <div class="col-12"><input class="form-control form-control-sm" name="default_model" placeholder="é»˜è®¤æ¨¡å‹ï¼ˆå¯é€‰ï¼‰"></div>
                <div class="col-12"><input class="form-control form-control-sm" name="description" placeholder="èŒè´£æè¿°ï¼ˆå¯é€‰ï¼‰"></div>
                <div class="col-12"><button class="btn btn-sm btn-primary">åˆ›å»ºè§’è‰²</button></div>
              </form>
            </details>
          </div>
        </div>

        <div class="card soft-card mb-3">
          <div class="card-header">å·¥ä½œæµæ¨¡æ¿ä¸­å¿ƒ</div>
          <div class="card-body small">
            <div class="table-responsive mb-2">
              <table class="table table-sm align-middle">
                <thead><tr><th>æ¨¡æ¿</th><th>é˜¶æ®µ</th><th>é»˜è®¤è§’è‰²</th><th></th></tr></thead>
                <tbody>
                  {% for wf in workflows %}
                  <tr>
                    <td>
                      <div class="fw-semibold">{{ wf.name }}</div>
                      <div class="text-muted">{{ wf.code }}</div>
                    </td>
                    <td>{{ ' â†’ '.join(wf.stages) if wf.stages else '-' }}</td>
                    <td>{{ wf.default_assignee or '-' }}</td>
                    <td>
                      <form method="post" action="{{ url_for('toggle_workflow', workflow_id=wf.id) }}">
                        <button class="btn btn-sm btn-outline-secondary">{% if wf.enabled == 1 %}åœç”¨{% else %}å¯ç”¨{% endif %}</button>
                      </form>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>

            <details>
              <summary>æ–°å¢å·¥ä½œæµæ¨¡æ¿</summary>
              <form class="row g-2 mt-1" method="post" action="{{ url_for('create_workflow') }}">
                <div class="col-12"><input class="form-control form-control-sm" name="code" placeholder="codeï¼Œä¾‹å¦‚ dev_test_verify" required></div>
                <div class="col-12"><input class="form-control form-control-sm" name="name" placeholder="æ¨¡æ¿åç§°" required></div>
                <div class="col-12"><input class="form-control form-control-sm" name="default_assignee" placeholder="é»˜è®¤è§’è‰²ï¼Œä¾‹å¦‚ @developer"></div>
                <div class="col-12"><input class="form-control form-control-sm" name="stages" placeholder="é˜¶æ®µï¼Œé€—å·åˆ†éš”ï¼Œå¦‚ å¼€å‘,æµ‹è¯•,éªŒè¯,äº¤ä»˜"></div>
                <div class="col-12"><input class="form-control form-control-sm" name="description" placeholder="æ¨¡æ¿æè¿°ï¼ˆå¯é€‰ï¼‰"></div>
                <div class="col-12"><input class="form-control form-control-sm" name="command_template" placeholder="å‘½ä»¤æ¨¡æ¿ï¼ˆå¯é€‰ï¼Œæ”¯æŒ __PROJECT_DIR__ï¼‰"></div>
                <div class="col-8">
                  <select class="form-select form-select-sm" name="default_task_type">
                    <option value="general">generalï¼ˆé€šç”¨ï¼‰</option>
                    <option value="backend">backendï¼ˆç ”å‘ï¼‰</option>
                    <option value="research">researchï¼ˆè°ƒç ”ï¼‰</option>
                    <option value="ops">opsï¼ˆè¿ç»´ï¼‰</option>
                  </select>
                </div>
                <div class="col-4 d-grid"><button class="btn btn-sm btn-primary">åˆ›å»º</button></div>
              </form>
            </details>
          </div>
        </div>

        <div class="card soft-card">
          <div class="card-header">æ“ä½œæç¤º</div>
          <div class="card-body small text-muted">
            <ul class="mb-0">
              <li><b>å¯åŠ¨</b>ï¼šåŠ å…¥æ‰§è¡Œé˜Ÿåˆ—ï¼›å¹¶å‘æ»¡ä¼šè‡ªåŠ¨æ’é˜Ÿã€‚</li>
              <li><b>åœæ­¢</b>ï¼šä¸­æ­¢ä»»åŠ¡å¹¶æ ‡è®°å¤±è´¥ã€‚</li>
              <li><b>é‡ç½®</b>ï¼šå°† done/failed æ¢å¤æˆ pendingã€‚</li>
              <li><b>ä»»åŠ¡è¯¦æƒ…</b>ï¼šæŸ¥çœ‹äº¤ä»˜æ€»è§ˆã€ä¸‹è½½äº§ç‰©ã€çœ‹å®æ—¶æ—¥å¿—ã€‚</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
let autoRefreshEnabled = true;
let formDirty = false;

function setDirty() {
  formDirty = true;
}

function toggleAutoRefresh() {
  autoRefreshEnabled = !autoRefreshEnabled;
  const btn = document.getElementById('toggleRefreshBtn');
  if (btn) {
    btn.textContent = autoRefreshEnabled ? 'è‡ªåŠ¨åˆ·æ–°ï¼šå¼€' : 'è‡ªåŠ¨åˆ·æ–°ï¼šå…³';
  }
}

function onWorkflowChange() {
  const wf = document.getElementById('workflow_template');
  const cmdInput = document.getElementById('command_input');
  const expectation = document.querySelector('input[name="delivery_expectation"]');
  const assignee = document.querySelector('select[name="assignee"]');
  const taskType = document.querySelector('select[name="task_type"]');
  if (!wf || !cmdInput) return;

  const opt = wf.options[wf.selectedIndex];
  const defAssignee = opt?.getAttribute('data-default-assignee') || '';
  const defTaskType = opt?.getAttribute('data-default-task-type') || '';

  if (defAssignee && assignee) {
    assignee.value = defAssignee;
  }
  if (defTaskType && taskType) {
    taskType.value = defTaskType;
  }

  if (wf.value === 'novel_multiagent') {
    cmdInput.placeholder = 'ç•™ç©ºå³å¯ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå°è¯´å¤šAgentæµæ°´çº¿å‘½ä»¤';
    if (expectation && !expectation.value) {
      expectation.value = 'éœ€è¦å…³é”®è¯æŠ¥å‘Šã€çˆ†æ¬¾æ ‡é¢˜æ¨¡æ¿ã€å¼€å¤´æ¨¡æ¿ã€å‹ç¼©åŒ…äº¤ä»˜';
    }
  } else if (wf.value === 'xhs_virtual_keywords') {
    cmdInput.placeholder = 'ç•™ç©ºå³å¯ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå°çº¢ä¹¦å…³é”®è¯åˆ†æå‘½ä»¤';
    if (expectation && !expectation.value) {
      expectation.value = 'éœ€è¦é«˜é¢‘è¯æŠ¥å‘Šï¼ˆmd/jsonï¼‰å’Œå¯ä¸‹è½½äº§ç‰©';
    }
  } else {
    cmdInput.placeholder = 'ç•™ç©º=æŒ‰æ¨¡æ¿è‡ªåŠ¨ç”Ÿæˆå‘½ä»¤ï¼›å¦‚æ¨¡æ¿æ— å‘½ä»¤åˆ™æ¼”ç¤ºæµç¨‹';
  }
  formDirty = true;
}

(function initAutoRefreshGuard() {
  const fields = document.querySelectorAll('input, select, textarea');
  fields.forEach((el) => {
    el.addEventListener('input', setDirty);
    el.addEventListener('change', setDirty);
  });

  onWorkflowChange();

  setInterval(() => {
    if (!autoRefreshEnabled) return;
    if (formDirty) return;
    const active = document.activeElement;
    if (active && active.closest && active.closest('form')) return;
    window.location.reload();
  }, 7000);
})();
</script>
</body>
</html>
